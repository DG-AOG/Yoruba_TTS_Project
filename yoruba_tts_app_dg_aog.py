# -*- coding: utf-8 -*-
"""Yoruba_TTS_App_DG-AOG.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/14O9Npb7Yd3xDB_GIM6dLMX06ibcMTu47
"""

pip install gradio

import gradio as gr
import requests

# Yoruba text auto-formatting dictionary
yoruba_map = {
    "nife": "n√≠f·∫πÃÄ·∫πÃÅ",
    "mo": "Mo",
    "re": "r·∫π",
    "e": "·∫π",
    "je": "j·∫π",
    "gba": "gb·ªçÃÅ",
    "o": "·ªå",
    "odun": "·ªåd√∫n",
    "dara": "d√°ra",
    "pupo": "p√∫p·ªçÃÄ",
    "se": "·π£√©",
    "bawo": "B√°wo",
    "ni": "n√≠",
    "ile": "il√©",
    "ise": "√¨·π£·∫πÃÅ",
    "owo": "√≤w√≤",
    "orin": "·ªçÃÄr√¨n",
    "oko": "·ªçk·ªç",
    "iya": "√¨y√°",
    "baba": "b√†b√°",
    "omo": "·ªçm·ªç",
    "ile-iwe": "il√©-√¨w√©",
    "owo": "·ªçÃÄw·ªçÃÄ",
    "alafia": "√†l√†√°f√≠√†",
    "aiku": "√†√¨k√∫",
    "aabo": "√†√†b√≤",
    "aare": "√†√†r·∫πÃÅ",
    "ojo": "·ªçj·ªçÃÅ",
    "ayika": "√†y√≠k√°",
    "idunnu": "√¨d√πnn√∫",
    "ifokanbale": "√¨f·∫πÃÅk√†nbal·∫πÃÄ",
    "ayemi": "√†y√© mi",
    "ire": "√¨r·∫πÃÄ",
    "igba": "√¨gb√†",
    "ibanuje": "√¨b√†n√∫j·∫πÃÅ",
    "ayewo": "√†y·∫πÃÄw√≤",
    "arin": "√†√°r√≠n",
    "alubarika": "√†lubar√≠k√†",
    "agun": "√†g√πnt√†n",
    "asiko": "√†s√¨k√≤",
    "aago": "√†√†g√≤",
    "ofe": "√≤f√©",
    "aaye": "√†y√©",
}

# Formatter function
def format_yoruba_text(text):
    words = text.lower().split()
    formatted = []
    for word in words:
        if word in yoruba_map:
            formatted.append(yoruba_map[word])
        else:
            formatted.append(word)
    return " ".join(formatted).capitalize()

# TTS function
def text_to_speech(text, voice_id, api_key):
    url = f"https://api.elevenlabs.io/v1/text-to-speech/{voice_id}"
    headers = {
        "xi-api-key": api_key,
        "Content-Type": "application/json"
    }
    payload = {
        "text": text,
        "voice_settings": {
            "stability": 0.5,
            "similarity_boost": 0.75
        }
    }

    response = requests.post(url, headers=headers, json=payload)

    if response.status_code == 200:
        audio_path = "yoruba_output.mp3"
        with open(audio_path, "wb") as f:
            f.write(response.content)
        return audio_path, audio_path
    else:
        return None, f"‚ùå Error: {response.status_code} - {response.text}"

# Gradio app logic
def app_interface(yoruba_text, voice_id, api_key):
    formatted_text = format_yoruba_text(yoruba_text)
    audio, error = text_to_speech(formatted_text, voice_id, api_key)
    if audio:
        return audio, audio
    else:
        return None, error

# Gradio UI setup
demo = gr.Interface(
    fn=app_interface,
    inputs=[
        gr.Textbox(label="üí¨ Enter Yoruba Text"),
        gr.Textbox(label="üó£Ô∏è Voice ID"),
        gr.Textbox(label="üîê API Key", type="password")
    ],
    outputs=[
        gr.Audio(label="üîä Play Yoruba Speech"),
        gr.File(label="‚¨áÔ∏è Download Audio File")
    ],
    title="DG-AOG Yoruba TTS App",
    description="Type Yoruba text with tones, choose a voice ID, and enter your ElevenLabs API key. The system formats your text and speaks it aloud. K√≠ ·ªål·ªçÃÅrun b√π k√∫n ·∫π"
)

demo.launch(share=True)

